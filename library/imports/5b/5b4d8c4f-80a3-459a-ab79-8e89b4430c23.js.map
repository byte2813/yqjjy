{"version":3,"sources":["assets\\Script\\eq4096.js"],"names":["eqconf","require","EQ","peq","Enable","config","enable","Disable","init","_this","cid","EQCID","appid","WXAPPID","wxauth","EQWXAUTH","version","EQVERSION","data","wx","onShow","res","onHide","onError","msg","stack","launcheroption","getLaunchOptionsSync","getSystemInfo","sysinfo","e","f","onTouchEnd","touchend","syncdata","event","undefined","codelogin","_this2","console","log","d","code","request","url","wxlogin","method","dataType","success","ret","openid","showuserinfobutton","fail","_this3","login","_this4","checkSession","getStorage","key","_this5","button","createUserInfoButton","onTap","p","openId","userInfo","userinfo","setStorage","p2","destroy","p3","getconfig","setuserinfo","s","debug","error","touchflag","_this6","JSON","stringify","api_url","parseconfig","touch","_this7","type","previewImage","urls","opdata","SyncData","start_res","parse","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["\nvar eqconf = require('./eqconf.js');\n\nvar EQ = {\n    peq : null,\n    Enable() {\n    if (this.peq) this.peq.config.enable = true;\n  },\n   Disable() {\n    if (this.peq)this.peq.config.enable = false;\n  },\n  init(config) {\n    this.config = config;\n    this.config.cid = eqconf.EQCID;\n    this.config.appid = eqconf.WXAPPID;\n    this.config.wxauth = eqconf.EQWXAUTH;\n    this.config.version = eqconf.EQVERSION;\n    this.config.enable = false;\n    this.config.data = {};\n    wx.onShow((res) => { this.onShow(res); });\n    wx.onHide((res) => { this.onHide(res); });\n    wx.onError((msg, stack) => { this.onError(msg, stack); });\n    this.config.launcheroption = wx.getLaunchOptionsSync();\n    wx.getSystemInfo((res) => {\n      this.config.sysinfo = res;\n    }, (e) => { }, (f) => { });\n    wx.onTouchEnd((res) => {\n      this.touchend(res);\n    });\n    this.peq = this;\n    this.peq.syncdata();\n\n  },\n  event(e) {\n    this.peq.config.event = e;\n    this.peq.syncdata();\n    this.peq.config.event = undefined;\n  },\n  codelogin(res) {\n    console.log(\"codelogin===》\", res)\n    this.d(res);\n    this.config.code = res.code;\n    this.d(this.config);\n    wx.request({\n      url: this.config.wxlogin,\n      method: \"POST\",\n      dataType: \"json\",\n      data: this.config,\n      success: (d) => {\n        this.d(d);\n        console.log(\"微信登录===》\", d.data.data)\n        if (d.data.ret == 0) {\n          var openid = d.data.data.openid;\n          res.openid = openid;\n          this.showuserinfobutton(res);\n        } else {\n          res.fail(d.data);\n        }\n      },\n      fail: (data) => {\n        this.d(data);\n        res.fail(data);\n      }\n    });\n  },\n\n\n\n  wxlogin(config) {\n    console.log(\"wxlogin===》\", config)\n    wx.login({\n      success: (res) => {\n        this.d(res);\n        console.log(\"微信登录code===》\", res)\n        if (res.code) {\n          config.code = res.code;\n          this.peq.codelogin(config);\n        } else {\n          config.fail(res);\n        }\n      }\n    });\n  },\n\n  login(config) {\n    console.log(\"login===》\", config)\n    wx.checkSession({\n      success:(res)=>{\n        // 未过期\n        config.success(res);\n        wx.getStorage({\n          key:'eq4096user.json', \n          success: (res)=> {\n            if(res.data) {\n              this.peq.d(\"read userinfo\");\n              config.success(res.data);\n            } else {\n              this.peq.wxlogin(config);\n            }\n          },\n          fail:(res)=>{\n            this.peq.wxlogin(config);\n          }\n        });\n      },\n      fail:()=>{\n        // 过期\n        this.peq.wxlogin(config);\n      }\n    });\n  },\n  showuserinfobutton(res) {\n    let button = wx.createUserInfoButton(res);\n    button.onTap((p) => {\n      this.d(p);\n      p.openId = res.openid;\n      p.userInfo.openId = res.openid;\n      this.config.userinfo = p;\n      wx.setStorage({\n        key: 'eq4096user.json',\n        data: p,\n        success: (p2)=> {\n          res.success(p);\n          button.destroy();\n        },\n        fail: (p3)=> {\n          res.fail(p3);\n        }\n      });\n      this.syncdata();\n    });\n  },\n\n  getconfig() {\n    return this.peq.config;\n  },\n  setuserinfo(userinfo) {\n    if (!this.peq.config.userinfo) {\n      this.peq.config.userinfo = userinfo;\n      this.peq.syncdata();\n    }\n  },\n  d(s) {\n    if (this.config.debug) console.log(s);\n  },\n\n\n  onError(msg, stack) {\n    this.config.error = { msg, stack };\n    this.syncdata();\n    this.config.error = undefined;\n    if (this.config.onError) {\n      this.config.onError(msg, stack);\n    }\n  },\n  touchend(res) {\n    this.touchflag = true;\n  },\n  syncdata() {\n    this.d(JSON.stringify(this.config));\n    wx.request({\n      url: this.config.api_url,\n      method: \"POST\",\n      dataType: \"json\",\n      data: this.config,\n      success: (d) => {\n        this.d(d);\n        if (d.data.ret == 0) {\n          this.parseconfig(d.data.data);\n        }\n      },\n      fail: (data) => {\n        console.log(data);\n      }\n    });\n  },\n\n  touch(d) {\n    switch (d.type) {\n      case \"img\":\n        wx.previewImage({ urls: [d[\"shareimage\"]] });\n        break;\n      case \"wxapp\": {\n        d.success = () => {\n          this.peq.config.opdata = d;\n          this.peq.syncdata();\n          this.peq.config.opdata = undefined;\n        };\n        wx[d[\"op\"]](d);\n      }\n        break;\n    }\n  },\n  SyncData()\n  {\n    if(this.peq) this.peq.syncdata();\n  },\n  onShow(res) {\n    this.config.start_res = res;\n    if (this.config.onShow) {\n      this.config.onShow(res);\n    }\n  },\n\n  onHide(res) {\n    if (this.config.onHide)\n      this.config.onHide(res);\n  },\n\n  parseconfig(data) {\n      this.config.data = data;\n      if(this.config.parse) {\n        this.config.parse(data);\n      }\n\n  }\n};\nmodule.exports = EQ;\n"]}