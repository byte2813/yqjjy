{"version":3,"sources":["assets\\Script\\panel\\RankingListView.js"],"names":["GameConfig","require","GameTools","cc","Class","Component","properties","shareButton","Node","rankingScrollView","Sprite","shareTicket","worldRankLayout","prefabRankItem","Prefab","selfcontent","onLoad","start","window","cp","sys","platform","QQ_PLAY","drawQQRank","showFriendRank","IS_GAME_SHARE","active","attr","order","rankType","BK","QQ","getRankListWithoutRoom","errCode","cmd","data","Script","log","JSON","stringify","i","ranking_list","length","rd","item","instantiate","getComponent","init","addChild","selfFlag","userItem","gameTypeNode","addComponent","Label","string","node","WECHAT_GAME","sharedCanvas","undefined","tex","Texture2D","console","wx","postMessage","messageType","MAIN_MENU_NUM","label","lineHeight","buttonFunc","event","playSimpleAudioEngine","sharePicture","backButtonFunc","removeRankData","destroy","_updateSubDomainCanvas","openDataContext","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","update"],"mappings":"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","sourceRoot":"/","sourcesContent":["var GameConfig = require(\"GameConfig\");\r\nvar GameTools = require(\"GameTools\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        // backButton: cc.Node,\r\n        shareButton: cc.Node, //分享按钮\r\n        rankingScrollView: cc.Sprite,//显示排行榜\r\n        shareTicket: null,\r\n        worldRankLayout:cc.Node,\r\n        prefabRankItem:cc.Prefab,\r\n        selfcontent:cc.Node,\r\n    },\r\n    onLoad() {\r\n    },\r\n    start() {\r\n        window.cp = this;\r\n        if(cc.sys.platform === cc.sys.QQ_PLAY){\r\n            this.drawQQRank();\r\n        }else{\r\n            this.showFriendRank();\r\n            if(!GameConfig.IS_GAME_SHARE){\r\n                this.shareButton.active = false;\r\n            }\r\n        } \r\n    },\r\n\r\n    drawQQRank: function () {\r\n        var attr = \"score\";\r\n        var order = 1;\r\n        var rankType = 0;\r\n        BK.QQ.getRankListWithoutRoom(attr, order, rankType, function (errCode, cmd, data) {\r\n            BK.Script.log(1, 1, \"getRankListWithoutRoom callback  cmd\" + cmd + \" errCode:\" + errCode + \"  data:\" + JSON.stringify(data));\r\n            // 返回错误码信息\r\n            if (errCode !== 0) {\r\n                BK.Script.log(1, 1, '获取排行榜数据失败!错误码：' + errCode);\r\n                return;\r\n            }\r\n            // 解析数据\r\n            if (data) {\r\n                for (var i = 0; i < data.data.ranking_list.length; ++i) {\r\n                    var rd = data.data.ranking_list[i];\r\n                    // BK.Script.log(1, 1, '解析数据：' + rd);\r\n                    let item = cc.instantiate(window.cp.prefabRankItem);\r\n                    item.getComponent('RankItem').init(i, rd);\r\n                    window.cp.worldRankLayout.addChild(item);\r\n                    if (rd.selfFlag) {\r\n                        let userItem = cc.instantiate(window.cp.prefabRankItem);\r\n                        userItem.getComponent('RankItem').init(i, rd);\r\n                        // userItem.y = -259;\r\n                        window.cp.selfcontent.active = true;\r\n                        window.cp.selfcontent.addChild(userItem);\r\n\r\n                    }\r\n\r\n                }\r\n            }else{\r\n                let gameTypeNode = new cc.Node();\r\n                gameTypeNode.addComponent(cc.Label).string = \"暂无排行榜数据\";\r\n                window.cp.node.addChild(gameTypeNode);\r\n            }\r\n        });\r\n    },\r\n    showFriendRank() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            if (window.sharedCanvas != undefined) {\r\n                this.tex = new cc.Texture2D();\r\n                // window.sharedCanvas.width = 750;\r\n                // window.sharedCanvas.height = 1334;\r\n                // 发消息给子域\r\n                console.log(\"发消息给子域\",this.tex )\r\n                if (this.shareTicket != null) {\r\n                    window.wx.postMessage({\r\n                        messageType: 5,\r\n                        MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,\r\n                        shareTicket: this.shareTicket\r\n                    });\r\n                } else {\r\n                    window.wx.postMessage({\r\n                        messageType: 1,\r\n                        MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,\r\n                    });\r\n                }\r\n            }\r\n        } else {\r\n            let gameTypeNode = new cc.Node();\r\n            let label = gameTypeNode.addComponent(cc.Label);\r\n            label.string = \"暂无好友排行榜数据\";\r\n            label.lineHeight = 60;\r\n            this.node.addChild(gameTypeNode);\r\n        }\r\n    },\r\n    buttonFunc: function (event) {\r\n        GameTools.playSimpleAudioEngine(3);\r\n        // let button = event.target;\r\n        // if (this.shareButton == button) {\r\n        GameTools.sharePicture();\r\n        // }\r\n        // return true;\r\n    },\r\n    backButtonFunc: function (event) {\r\n        GameTools.removeRankData();\r\n\r\n        this.node.destroy();\r\n    },\r\n\r\n    // 刷新子域的纹理\r\n    _updateSubDomainCanvas() {\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            if (window.sharedCanvas != undefined) {\r\n                console.log(\"刷新子域的纹理:\",this.tex)\r\n                let openDataContext = wx.getOpenDataContext();\r\n                let sharedCanvas = openDataContext.canvas;\r\n                console.log(\"刷新子域的纹理openDataContext:\",openDataContext)\r\n                console.log(\"刷新子域的纹理sharedCanvas:\",sharedCanvas)\r\n                this.tex.initWithElement(window.sharedCanvas);\r\n                this.tex.handleLoadedTexture();\r\n                this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\r\n            }\r\n        }\r\n    },\r\n    update() {\r\n        this._updateSubDomainCanvas();\r\n    },\r\n});\r\n"]}