
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/panel/RankingListView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7ab62uB5zZKCLuVeGbY8aHs', 'RankingListView');
// Script/panel/RankingListView.js

"use strict";

var GameConfig = require("GameConfig");
var GameTools = require("GameTools");
cc.Class({
  "extends": cc.Component,
  properties: {
    // backButton: cc.Node,
    shareButton: cc.Node,
    //分享按钮
    rankingScrollView: cc.Sprite,
    //显示排行榜
    shareTicket: null,
    worldRankLayout: cc.Node,
    prefabRankItem: cc.Prefab,
    selfcontent: cc.Node
  },
  onLoad: function onLoad() {},
  start: function start() {
    window.cp = this;
    if (cc.sys.platform === cc.sys.QQ_PLAY) {
      this.drawQQRank();
    } else {
      this.showFriendRank();
      if (!GameConfig.IS_GAME_SHARE) {
        this.shareButton.active = false;
      }
    }
  },
  drawQQRank: function drawQQRank() {
    var attr = "score";
    var order = 1;
    var rankType = 0;
    BK.QQ.getRankListWithoutRoom(attr, order, rankType, function (errCode, cmd, data) {
      BK.Script.log(1, 1, "getRankListWithoutRoom callback  cmd" + cmd + " errCode:" + errCode + "  data:" + JSON.stringify(data));
      // 返回错误码信息
      if (errCode !== 0) {
        BK.Script.log(1, 1, '获取排行榜数据失败!错误码：' + errCode);
        return;
      }
      // 解析数据
      if (data) {
        for (var i = 0; i < data.data.ranking_list.length; ++i) {
          var rd = data.data.ranking_list[i];
          // BK.Script.log(1, 1, '解析数据：' + rd);
          var item = cc.instantiate(window.cp.prefabRankItem);
          item.getComponent('RankItem').init(i, rd);
          window.cp.worldRankLayout.addChild(item);
          if (rd.selfFlag) {
            var userItem = cc.instantiate(window.cp.prefabRankItem);
            userItem.getComponent('RankItem').init(i, rd);
            // userItem.y = -259;
            window.cp.selfcontent.active = true;
            window.cp.selfcontent.addChild(userItem);
          }
        }
      } else {
        var gameTypeNode = new cc.Node();
        gameTypeNode.addComponent(cc.Label).string = "暂无排行榜数据";
        window.cp.node.addChild(gameTypeNode);
      }
    });
  },
  showFriendRank: function showFriendRank() {
    if (cc.sys.platform === cc.sys.WECHAT_GAME) {
      if (window.sharedCanvas != undefined) {
        this.tex = new cc.Texture2D();
        // window.sharedCanvas.width = 750;
        // window.sharedCanvas.height = 1334;
        // 发消息给子域
        console.log("发消息给子域", this.tex);
        if (this.shareTicket != null) {
          window.wx.postMessage({
            messageType: 5,
            MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM,
            shareTicket: this.shareTicket
          });
        } else {
          window.wx.postMessage({
            messageType: 1,
            MAIN_MENU_NUM: GameConfig.MAIN_MENU_NUM
          });
        }
      }
    } else {
      var gameTypeNode = new cc.Node();
      var label = gameTypeNode.addComponent(cc.Label);
      label.string = "暂无好友排行榜数据";
      label.lineHeight = 60;
      this.node.addChild(gameTypeNode);
    }
  },
  buttonFunc: function buttonFunc(event) {
    GameTools.playSimpleAudioEngine(3);
    // let button = event.target;
    // if (this.shareButton == button) {
    GameTools.sharePicture();
    // }
    // return true;
  },

  backButtonFunc: function backButtonFunc(event) {
    GameTools.removeRankData();
    this.node.destroy();
  },
  // 刷新子域的纹理
  _updateSubDomainCanvas: function _updateSubDomainCanvas() {
    if (cc.sys.platform === cc.sys.WECHAT_GAME) {
      if (window.sharedCanvas != undefined) {
        console.log("刷新子域的纹理:", this.tex);
        var openDataContext = wx.getOpenDataContext();
        var sharedCanvas = openDataContext.canvas;
        console.log("刷新子域的纹理openDataContext:", openDataContext);
        console.log("刷新子域的纹理sharedCanvas:", sharedCanvas);
        this.tex.initWithElement(window.sharedCanvas);
        this.tex.handleLoadedTexture();
        this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);
      }
    }
  },
  update: function update() {
    this._updateSubDomainCanvas();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxwYW5lbFxcUmFua2luZ0xpc3RWaWV3LmpzIl0sIm5hbWVzIjpbIkdhbWVDb25maWciLCJyZXF1aXJlIiwiR2FtZVRvb2xzIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzaGFyZUJ1dHRvbiIsIk5vZGUiLCJyYW5raW5nU2Nyb2xsVmlldyIsIlNwcml0ZSIsInNoYXJlVGlja2V0Iiwid29ybGRSYW5rTGF5b3V0IiwicHJlZmFiUmFua0l0ZW0iLCJQcmVmYWIiLCJzZWxmY29udGVudCIsIm9uTG9hZCIsInN0YXJ0Iiwid2luZG93IiwiY3AiLCJzeXMiLCJwbGF0Zm9ybSIsIlFRX1BMQVkiLCJkcmF3UVFSYW5rIiwic2hvd0ZyaWVuZFJhbmsiLCJJU19HQU1FX1NIQVJFIiwiYWN0aXZlIiwiYXR0ciIsIm9yZGVyIiwicmFua1R5cGUiLCJCSyIsIlFRIiwiZ2V0UmFua0xpc3RXaXRob3V0Um9vbSIsImVyckNvZGUiLCJjbWQiLCJkYXRhIiwiU2NyaXB0IiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsImkiLCJyYW5raW5nX2xpc3QiLCJsZW5ndGgiLCJyZCIsIml0ZW0iLCJpbnN0YW50aWF0ZSIsImdldENvbXBvbmVudCIsImluaXQiLCJhZGRDaGlsZCIsInNlbGZGbGFnIiwidXNlckl0ZW0iLCJnYW1lVHlwZU5vZGUiLCJhZGRDb21wb25lbnQiLCJMYWJlbCIsInN0cmluZyIsIm5vZGUiLCJXRUNIQVRfR0FNRSIsInNoYXJlZENhbnZhcyIsInVuZGVmaW5lZCIsInRleCIsIlRleHR1cmUyRCIsImNvbnNvbGUiLCJ3eCIsInBvc3RNZXNzYWdlIiwibWVzc2FnZVR5cGUiLCJNQUlOX01FTlVfTlVNIiwibGFiZWwiLCJsaW5lSGVpZ2h0IiwiYnV0dG9uRnVuYyIsImV2ZW50IiwicGxheVNpbXBsZUF1ZGlvRW5naW5lIiwic2hhcmVQaWN0dXJlIiwiYmFja0J1dHRvbkZ1bmMiLCJyZW1vdmVSYW5rRGF0YSIsImRlc3Ryb3kiLCJfdXBkYXRlU3ViRG9tYWluQ2FudmFzIiwib3BlbkRhdGFDb250ZXh0IiwiZ2V0T3BlbkRhdGFDb250ZXh0IiwiY2FudmFzIiwiaW5pdFdpdGhFbGVtZW50IiwiaGFuZGxlTG9hZGVkVGV4dHVyZSIsInNwcml0ZUZyYW1lIiwiU3ByaXRlRnJhbWUiLCJ1cGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsVUFBVSxHQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDO0FBQ3RDLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNwQ0UsRUFBRSxDQUFDQyxLQUFLLENBQUM7RUFDTCxXQUFTRCxFQUFFLENBQUNFLFNBQVM7RUFDckJDLFVBQVUsRUFBRTtJQUNSO0lBQ0FDLFdBQVcsRUFBRUosRUFBRSxDQUFDSyxJQUFJO0lBQUU7SUFDdEJDLGlCQUFpQixFQUFFTixFQUFFLENBQUNPLE1BQU07SUFBQztJQUM3QkMsV0FBVyxFQUFFLElBQUk7SUFDakJDLGVBQWUsRUFBQ1QsRUFBRSxDQUFDSyxJQUFJO0lBQ3ZCSyxjQUFjLEVBQUNWLEVBQUUsQ0FBQ1csTUFBTTtJQUN4QkMsV0FBVyxFQUFDWixFQUFFLENBQUNLO0VBQ25CLENBQUM7RUFDRFEsTUFBTSxXQUFBQSxPQUFBLEVBQUcsQ0FDVCxDQUFDO0VBQ0RDLEtBQUssV0FBQUEsTUFBQSxFQUFHO0lBQ0pDLE1BQU0sQ0FBQ0MsRUFBRSxHQUFHLElBQUk7SUFDaEIsSUFBR2hCLEVBQUUsQ0FBQ2lCLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLbEIsRUFBRSxDQUFDaUIsR0FBRyxDQUFDRSxPQUFPLEVBQUM7TUFDbEMsSUFBSSxDQUFDQyxVQUFVLEVBQUU7SUFDckIsQ0FBQyxNQUFJO01BQ0QsSUFBSSxDQUFDQyxjQUFjLEVBQUU7TUFDckIsSUFBRyxDQUFDeEIsVUFBVSxDQUFDeUIsYUFBYSxFQUFDO1FBQ3pCLElBQUksQ0FBQ2xCLFdBQVcsQ0FBQ21CLE1BQU0sR0FBRyxLQUFLO01BQ25DO0lBQ0o7RUFDSixDQUFDO0VBRURILFVBQVUsRUFBRSxTQUFBQSxXQUFBLEVBQVk7SUFDcEIsSUFBSUksSUFBSSxHQUFHLE9BQU87SUFDbEIsSUFBSUMsS0FBSyxHQUFHLENBQUM7SUFDYixJQUFJQyxRQUFRLEdBQUcsQ0FBQztJQUNoQkMsRUFBRSxDQUFDQyxFQUFFLENBQUNDLHNCQUFzQixDQUFDTCxJQUFJLEVBQUVDLEtBQUssRUFBRUMsUUFBUSxFQUFFLFVBQVVJLE9BQU8sRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEVBQUU7TUFDOUVMLEVBQUUsQ0FBQ00sTUFBTSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxzQ0FBc0MsR0FBR0gsR0FBRyxHQUFHLFdBQVcsR0FBR0QsT0FBTyxHQUFHLFNBQVMsR0FBR0ssSUFBSSxDQUFDQyxTQUFTLENBQUNKLElBQUksQ0FBQyxDQUFDO01BQzVIO01BQ0EsSUFBSUYsT0FBTyxLQUFLLENBQUMsRUFBRTtRQUNmSCxFQUFFLENBQUNNLE1BQU0sQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLEdBQUdKLE9BQU8sQ0FBQztRQUMvQztNQUNKO01BQ0E7TUFDQSxJQUFJRSxJQUFJLEVBQUU7UUFDTixLQUFLLElBQUlLLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0wsSUFBSSxDQUFDQSxJQUFJLENBQUNNLFlBQVksQ0FBQ0MsTUFBTSxFQUFFLEVBQUVGLENBQUMsRUFBRTtVQUNwRCxJQUFJRyxFQUFFLEdBQUdSLElBQUksQ0FBQ0EsSUFBSSxDQUFDTSxZQUFZLENBQUNELENBQUMsQ0FBQztVQUNsQztVQUNBLElBQUlJLElBQUksR0FBR3pDLEVBQUUsQ0FBQzBDLFdBQVcsQ0FBQzNCLE1BQU0sQ0FBQ0MsRUFBRSxDQUFDTixjQUFjLENBQUM7VUFDbkQrQixJQUFJLENBQUNFLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQ0MsSUFBSSxDQUFDUCxDQUFDLEVBQUVHLEVBQUUsQ0FBQztVQUN6Q3pCLE1BQU0sQ0FBQ0MsRUFBRSxDQUFDUCxlQUFlLENBQUNvQyxRQUFRLENBQUNKLElBQUksQ0FBQztVQUN4QyxJQUFJRCxFQUFFLENBQUNNLFFBQVEsRUFBRTtZQUNiLElBQUlDLFFBQVEsR0FBRy9DLEVBQUUsQ0FBQzBDLFdBQVcsQ0FBQzNCLE1BQU0sQ0FBQ0MsRUFBRSxDQUFDTixjQUFjLENBQUM7WUFDdkRxQyxRQUFRLENBQUNKLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQ0MsSUFBSSxDQUFDUCxDQUFDLEVBQUVHLEVBQUUsQ0FBQztZQUM3QztZQUNBekIsTUFBTSxDQUFDQyxFQUFFLENBQUNKLFdBQVcsQ0FBQ1csTUFBTSxHQUFHLElBQUk7WUFDbkNSLE1BQU0sQ0FBQ0MsRUFBRSxDQUFDSixXQUFXLENBQUNpQyxRQUFRLENBQUNFLFFBQVEsQ0FBQztVQUU1QztRQUVKO01BQ0osQ0FBQyxNQUFJO1FBQ0QsSUFBSUMsWUFBWSxHQUFHLElBQUloRCxFQUFFLENBQUNLLElBQUksRUFBRTtRQUNoQzJDLFlBQVksQ0FBQ0MsWUFBWSxDQUFDakQsRUFBRSxDQUFDa0QsS0FBSyxDQUFDLENBQUNDLE1BQU0sR0FBRyxTQUFTO1FBQ3REcEMsTUFBTSxDQUFDQyxFQUFFLENBQUNvQyxJQUFJLENBQUNQLFFBQVEsQ0FBQ0csWUFBWSxDQUFDO01BQ3pDO0lBQ0osQ0FBQyxDQUFDO0VBQ04sQ0FBQztFQUNEM0IsY0FBYyxXQUFBQSxlQUFBLEVBQUc7SUFDYixJQUFJckIsRUFBRSxDQUFDaUIsR0FBRyxDQUFDQyxRQUFRLEtBQUtsQixFQUFFLENBQUNpQixHQUFHLENBQUNvQyxXQUFXLEVBQUU7TUFDeEMsSUFBSXRDLE1BQU0sQ0FBQ3VDLFlBQVksSUFBSUMsU0FBUyxFQUFFO1FBQ2xDLElBQUksQ0FBQ0MsR0FBRyxHQUFHLElBQUl4RCxFQUFFLENBQUN5RCxTQUFTLEVBQUU7UUFDN0I7UUFDQTtRQUNBO1FBQ0FDLE9BQU8sQ0FBQ3hCLEdBQUcsQ0FBQyxRQUFRLEVBQUMsSUFBSSxDQUFDc0IsR0FBRyxDQUFFO1FBQy9CLElBQUksSUFBSSxDQUFDaEQsV0FBVyxJQUFJLElBQUksRUFBRTtVQUMxQk8sTUFBTSxDQUFDNEMsRUFBRSxDQUFDQyxXQUFXLENBQUM7WUFDbEJDLFdBQVcsRUFBRSxDQUFDO1lBQ2RDLGFBQWEsRUFBRWpFLFVBQVUsQ0FBQ2lFLGFBQWE7WUFDdkN0RCxXQUFXLEVBQUUsSUFBSSxDQUFDQTtVQUN0QixDQUFDLENBQUM7UUFDTixDQUFDLE1BQU07VUFDSE8sTUFBTSxDQUFDNEMsRUFBRSxDQUFDQyxXQUFXLENBQUM7WUFDbEJDLFdBQVcsRUFBRSxDQUFDO1lBQ2RDLGFBQWEsRUFBRWpFLFVBQVUsQ0FBQ2lFO1VBQzlCLENBQUMsQ0FBQztRQUNOO01BQ0o7SUFDSixDQUFDLE1BQU07TUFDSCxJQUFJZCxZQUFZLEdBQUcsSUFBSWhELEVBQUUsQ0FBQ0ssSUFBSSxFQUFFO01BQ2hDLElBQUkwRCxLQUFLLEdBQUdmLFlBQVksQ0FBQ0MsWUFBWSxDQUFDakQsRUFBRSxDQUFDa0QsS0FBSyxDQUFDO01BQy9DYSxLQUFLLENBQUNaLE1BQU0sR0FBRyxXQUFXO01BQzFCWSxLQUFLLENBQUNDLFVBQVUsR0FBRyxFQUFFO01BQ3JCLElBQUksQ0FBQ1osSUFBSSxDQUFDUCxRQUFRLENBQUNHLFlBQVksQ0FBQztJQUNwQztFQUNKLENBQUM7RUFDRGlCLFVBQVUsRUFBRSxTQUFBQSxXQUFVQyxLQUFLLEVBQUU7SUFDekJuRSxTQUFTLENBQUNvRSxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7SUFDbEM7SUFDQTtJQUNBcEUsU0FBUyxDQUFDcUUsWUFBWSxFQUFFO0lBQ3hCO0lBQ0E7RUFDSixDQUFDOztFQUNEQyxjQUFjLEVBQUUsU0FBQUEsZUFBVUgsS0FBSyxFQUFFO0lBQzdCbkUsU0FBUyxDQUFDdUUsY0FBYyxFQUFFO0lBRTFCLElBQUksQ0FBQ2xCLElBQUksQ0FBQ21CLE9BQU8sRUFBRTtFQUN2QixDQUFDO0VBRUQ7RUFDQUMsc0JBQXNCLFdBQUFBLHVCQUFBLEVBQUc7SUFDckIsSUFBSXhFLEVBQUUsQ0FBQ2lCLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLbEIsRUFBRSxDQUFDaUIsR0FBRyxDQUFDb0MsV0FBVyxFQUFFO01BQ3hDLElBQUl0QyxNQUFNLENBQUN1QyxZQUFZLElBQUlDLFNBQVMsRUFBRTtRQUNsQ0csT0FBTyxDQUFDeEIsR0FBRyxDQUFDLFVBQVUsRUFBQyxJQUFJLENBQUNzQixHQUFHLENBQUM7UUFDaEMsSUFBSWlCLGVBQWUsR0FBR2QsRUFBRSxDQUFDZSxrQkFBa0IsRUFBRTtRQUM3QyxJQUFJcEIsWUFBWSxHQUFHbUIsZUFBZSxDQUFDRSxNQUFNO1FBQ3pDakIsT0FBTyxDQUFDeEIsR0FBRyxDQUFDLHlCQUF5QixFQUFDdUMsZUFBZSxDQUFDO1FBQ3REZixPQUFPLENBQUN4QixHQUFHLENBQUMsc0JBQXNCLEVBQUNvQixZQUFZLENBQUM7UUFDaEQsSUFBSSxDQUFDRSxHQUFHLENBQUNvQixlQUFlLENBQUM3RCxNQUFNLENBQUN1QyxZQUFZLENBQUM7UUFDN0MsSUFBSSxDQUFDRSxHQUFHLENBQUNxQixtQkFBbUIsRUFBRTtRQUM5QixJQUFJLENBQUN2RSxpQkFBaUIsQ0FBQ3dFLFdBQVcsR0FBRyxJQUFJOUUsRUFBRSxDQUFDK0UsV0FBVyxDQUFDLElBQUksQ0FBQ3ZCLEdBQUcsQ0FBQztNQUNyRTtJQUNKO0VBQ0osQ0FBQztFQUNEd0IsTUFBTSxXQUFBQSxPQUFBLEVBQUc7SUFDTCxJQUFJLENBQUNSLHNCQUFzQixFQUFFO0VBQ2pDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgR2FtZUNvbmZpZyA9IHJlcXVpcmUoXCJHYW1lQ29uZmlnXCIpO1xyXG52YXIgR2FtZVRvb2xzID0gcmVxdWlyZShcIkdhbWVUb29sc1wiKTtcclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIC8vIGJhY2tCdXR0b246IGNjLk5vZGUsXHJcbiAgICAgICAgc2hhcmVCdXR0b246IGNjLk5vZGUsIC8v5YiG5Lqr5oyJ6ZKuXHJcbiAgICAgICAgcmFua2luZ1Njcm9sbFZpZXc6IGNjLlNwcml0ZSwvL+aYvuekuuaOkuihjOamnFxyXG4gICAgICAgIHNoYXJlVGlja2V0OiBudWxsLFxyXG4gICAgICAgIHdvcmxkUmFua0xheW91dDpjYy5Ob2RlLFxyXG4gICAgICAgIHByZWZhYlJhbmtJdGVtOmNjLlByZWZhYixcclxuICAgICAgICBzZWxmY29udGVudDpjYy5Ob2RlLFxyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpIHtcclxuICAgIH0sXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICB3aW5kb3cuY3AgPSB0aGlzO1xyXG4gICAgICAgIGlmKGNjLnN5cy5wbGF0Zm9ybSA9PT0gY2Muc3lzLlFRX1BMQVkpe1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdRUVJhbmsoKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5zaG93RnJpZW5kUmFuaygpO1xyXG4gICAgICAgICAgICBpZighR2FtZUNvbmZpZy5JU19HQU1FX1NIQVJFKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hhcmVCdXR0b24uYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IFxyXG4gICAgfSxcclxuXHJcbiAgICBkcmF3UVFSYW5rOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGF0dHIgPSBcInNjb3JlXCI7XHJcbiAgICAgICAgdmFyIG9yZGVyID0gMTtcclxuICAgICAgICB2YXIgcmFua1R5cGUgPSAwO1xyXG4gICAgICAgIEJLLlFRLmdldFJhbmtMaXN0V2l0aG91dFJvb20oYXR0ciwgb3JkZXIsIHJhbmtUeXBlLCBmdW5jdGlvbiAoZXJyQ29kZSwgY21kLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIEJLLlNjcmlwdC5sb2coMSwgMSwgXCJnZXRSYW5rTGlzdFdpdGhvdXRSb29tIGNhbGxiYWNrICBjbWRcIiArIGNtZCArIFwiIGVyckNvZGU6XCIgKyBlcnJDb2RlICsgXCIgIGRhdGE6XCIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAgICAgICAgIC8vIOi/lOWbnumUmeivr+eggeS/oeaBr1xyXG4gICAgICAgICAgICBpZiAoZXJyQ29kZSAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgQksuU2NyaXB0LmxvZygxLCAxLCAn6I635Y+W5o6S6KGM5qac5pWw5o2u5aSx6LSlIemUmeivr+egge+8micgKyBlcnJDb2RlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDop6PmnpDmlbDmja5cclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5kYXRhLnJhbmtpbmdfbGlzdC5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZCA9IGRhdGEuZGF0YS5yYW5raW5nX2xpc3RbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQksuU2NyaXB0LmxvZygxLCAxLCAn6Kej5p6Q5pWw5o2u77yaJyArIHJkKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGNjLmluc3RhbnRpYXRlKHdpbmRvdy5jcC5wcmVmYWJSYW5rSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5nZXRDb21wb25lbnQoJ1JhbmtJdGVtJykuaW5pdChpLCByZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNwLndvcmxkUmFua0xheW91dC5hZGRDaGlsZChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmQuc2VsZkZsYWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJJdGVtID0gY2MuaW5zdGFudGlhdGUod2luZG93LmNwLnByZWZhYlJhbmtJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlckl0ZW0uZ2V0Q29tcG9uZW50KCdSYW5rSXRlbScpLmluaXQoaSwgcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2VySXRlbS55ID0gLTI1OTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNwLnNlbGZjb250ZW50LmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jcC5zZWxmY29udGVudC5hZGRDaGlsZCh1c2VySXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgbGV0IGdhbWVUeXBlTm9kZSA9IG5ldyBjYy5Ob2RlKCk7XHJcbiAgICAgICAgICAgICAgICBnYW1lVHlwZU5vZGUuYWRkQ29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIuaaguaXoOaOkuihjOamnOaVsOaNrlwiO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmNwLm5vZGUuYWRkQ2hpbGQoZ2FtZVR5cGVOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIHNob3dGcmllbmRSYW5rKCkge1xyXG4gICAgICAgIGlmIChjYy5zeXMucGxhdGZvcm0gPT09IGNjLnN5cy5XRUNIQVRfR0FNRSkge1xyXG4gICAgICAgICAgICBpZiAod2luZG93LnNoYXJlZENhbnZhcyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4ID0gbmV3IGNjLlRleHR1cmUyRCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gd2luZG93LnNoYXJlZENhbnZhcy53aWR0aCA9IDc1MDtcclxuICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5zaGFyZWRDYW52YXMuaGVpZ2h0ID0gMTMzNDtcclxuICAgICAgICAgICAgICAgIC8vIOWPkea2iOaBr+e7meWtkOWfn1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLlj5Hmtojmga/nu5nlrZDln59cIix0aGlzLnRleCApXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaGFyZVRpY2tldCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lnd4LnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVR5cGU6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1BSU5fTUVOVV9OVU06IEdhbWVDb25maWcuTUFJTl9NRU5VX05VTSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVUaWNrZXQ6IHRoaXMuc2hhcmVUaWNrZXRcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lnd4LnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVR5cGU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1BSU5fTUVOVV9OVU06IEdhbWVDb25maWcuTUFJTl9NRU5VX05VTSxcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxldCBnYW1lVHlwZU5vZGUgPSBuZXcgY2MuTm9kZSgpO1xyXG4gICAgICAgICAgICBsZXQgbGFiZWwgPSBnYW1lVHlwZU5vZGUuYWRkQ29tcG9uZW50KGNjLkxhYmVsKTtcclxuICAgICAgICAgICAgbGFiZWwuc3RyaW5nID0gXCLmmoLml6Dlpb3lj4vmjpLooYzmppzmlbDmja5cIjtcclxuICAgICAgICAgICAgbGFiZWwubGluZUhlaWdodCA9IDYwO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUuYWRkQ2hpbGQoZ2FtZVR5cGVOb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgYnV0dG9uRnVuYzogZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgR2FtZVRvb2xzLnBsYXlTaW1wbGVBdWRpb0VuZ2luZSgzKTtcclxuICAgICAgICAvLyBsZXQgYnV0dG9uID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgICAgIC8vIGlmICh0aGlzLnNoYXJlQnV0dG9uID09IGJ1dHRvbikge1xyXG4gICAgICAgIEdhbWVUb29scy5zaGFyZVBpY3R1cmUoKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gcmV0dXJuIHRydWU7XHJcbiAgICB9LFxyXG4gICAgYmFja0J1dHRvbkZ1bmM6IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIEdhbWVUb29scy5yZW1vdmVSYW5rRGF0YSgpO1xyXG5cclxuICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyDliLfmlrDlrZDln5/nmoTnurnnkIZcclxuICAgIF91cGRhdGVTdWJEb21haW5DYW52YXMoKSB7XHJcbiAgICAgICAgaWYgKGNjLnN5cy5wbGF0Zm9ybSA9PT0gY2Muc3lzLldFQ0hBVF9HQU1FKSB7XHJcbiAgICAgICAgICAgIGlmICh3aW5kb3cuc2hhcmVkQ2FudmFzICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLliLfmlrDlrZDln5/nmoTnurnnkIY6XCIsdGhpcy50ZXgpXHJcbiAgICAgICAgICAgICAgICBsZXQgb3BlbkRhdGFDb250ZXh0ID0gd3guZ2V0T3BlbkRhdGFDb250ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2hhcmVkQ2FudmFzID0gb3BlbkRhdGFDb250ZXh0LmNhbnZhcztcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5Yi35paw5a2Q5Z+f55qE57q555CGb3BlbkRhdGFDb250ZXh0OlwiLG9wZW5EYXRhQ29udGV4dClcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5Yi35paw5a2Q5Z+f55qE57q555CGc2hhcmVkQ2FudmFzOlwiLHNoYXJlZENhbnZhcylcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4LmluaXRXaXRoRWxlbWVudCh3aW5kb3cuc2hhcmVkQ2FudmFzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4LmhhbmRsZUxvYWRlZFRleHR1cmUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmFua2luZ1Njcm9sbFZpZXcuc3ByaXRlRnJhbWUgPSBuZXcgY2MuU3ByaXRlRnJhbWUodGhpcy50ZXgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVTdWJEb21haW5DYW52YXMoKTtcclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=