
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/panel/TurnTable.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '98155fIsX5PzbBTLcSvAMUr', 'TurnTable');
// Script/panel/TurnTable.js

"use strict";

var GameConfig = require("GameConfig");
var GameTools = require("GameTools");
cc.Class({
  "extends": cc.Component,
  properties: {
    freeCJBtn: cc.Node,
    turnTable: {
      "default": null,
      type: cc.Node,
      displayName: "转盘"
    },
    turnNum: cc.Label
  },
  start: function start() {},
  onLoad: function onLoad() {
    this.isClick = false;
    this.isTurning = false;
    this.lastAngle = 0;
    window.cp = this;
    GameConfig.turnTableNum = GameTools.getItemByLocalStorage("turnNum", 3);
    this.turnCount();
  },
  vedioCJ: function vedioCJ() {
    GameTools.playSimpleAudioEngine(3);
    if (this.isTurning) {
      return;
    }
    if (cc.sys.platform === cc.sys.WECHAT_GAME) {
      // wx.aldSendEvent('视频抽奖',{'key' : 'value'});
    }
    GameTools._createVedioAd(function (res) {
      if (res.isEnded || res.raw) {
        GameConfig.turnTableNum += 2;
        window.cp.turnCount();
      }
    });
  },
  cjAction: function cjAction(callback) {
    // if(cc.sys.platform === cc.sys.WECHAT_GAME){
    //     wx.aldSendEvent('启动转盘',{'key' : 'value'})
    // }
    this.isClick = true;
    this.isTurning = true;
    //概率出结果
    var thanks = [0, 120, 240]; //金钱
    var coins = [60, 300]; //元宝
    var cards = [180]; //人
    var type;
    var num;
    var angle;
    var random = Math.random();
    if (random < 0.08) {
      angle = cards[0];
    } else if (random < 0.20) {
      type = 'coin';
      num = GameConfig.buyCoinUpgrade[GameConfig.GamePersonMaxLevel + 1] * 2;
      angle = coins[1];
    } else if (random < 0.35) {
      type = 'coin';
      num = GameConfig.buyCoinUpgrade[GameConfig.GamePersonMaxLevel + 1] * 4;
      angle = coins[0];
    } else if (0.7) {
      type = 'money';
      num = GameConfig.buyGoldUpgrade[GameConfig.GamePersonMaxLevel] * 4;
      angle = thanks[1];
    } else if (0.8) {
      type = 'money';
      num = GameConfig.buyGoldUpgrade[GameConfig.GamePersonMaxLevel] * 2;
      angle = thanks[0];
    } else {
      type = 'money';
      num = GameConfig.buyGoldUpgrade[GameConfig.GamePersonMaxLevel] * 6;
      angle = thanks[2];
    }
    var _this = this;
    var clickTimes = 6;
    var rounds = 10;
    var rotateBy = cc.rotateBy(clickTimes, this.lastAngle - (angle + 360 * rounds));
    var actionStep = _this.turnTable.runAction(rotateBy).easing(cc.easeCubicActionOut(clickTimes));
    this.scheduleOnce(function () {
      this.lastAngle = angle;
      callback && callback();
      console.log(type + " : " + num);
      this.isTurning = false;
      if (type == undefined) {
        GameTools.showToast('获得' + GameConfig.perName[GameConfig.GamePersonMaxLevel - 1]);
        GameConfig.main.addDeskSpriteByLevel(GameConfig.GamePersonMaxLevel);
      } else {
        if (type == 'coin') {
          GameTools.showToast("获得" + num + "元宝");
          GameConfig.GameCoin += num;
          GameTools.setItemByLocalStorage("GameCoin", GameConfig.GameCoin);
          GameConfig.main.setGameCoin();
        } else {
          GameTools.showToast("获得" + num + "铜钱");
          GameConfig.GameMoney += num;
          GameTools.setItemByLocalStorage("GameMoney", GameConfig.GameMoney);
          GameConfig.main.setGameMoney();
        }
      }
    }, 6);
  },
  freeCJ: function freeCJ() {
    GameTools.playSimpleAudioEngine(3);
    if (this.isTurning) {
      return;
    }
    if (cc.sys.platform === cc.sys.WECHAT_GAME) {
      // wx.aldSendEvent('抽奖',{'key' : 'value'});
    }
    if (GameConfig.turnTableNum < 1) {
      GameTools.showToast("暂无抽奖机会哦");
      return;
    }
    this.cjAction(function () {
      GameConfig.turnTableNum--;
      window.cp.turnCount();
    });
  },
  //抽奖次数的变动
  turnCount: function turnCount() {
    window.cp.turnNum.string = GameConfig.turnTableNum;
    GameTools.setItemByLocalStorage("turnNum", GameConfig.turnTableNum);
  },
  close: function close() {
    GameTools.playSimpleAudioEngine(3);
    this.node.destroy();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxwYW5lbFxcVHVyblRhYmxlLmpzIl0sIm5hbWVzIjpbIkdhbWVDb25maWciLCJyZXF1aXJlIiwiR2FtZVRvb2xzIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJmcmVlQ0pCdG4iLCJOb2RlIiwidHVyblRhYmxlIiwidHlwZSIsImRpc3BsYXlOYW1lIiwidHVybk51bSIsIkxhYmVsIiwic3RhcnQiLCJvbkxvYWQiLCJpc0NsaWNrIiwiaXNUdXJuaW5nIiwibGFzdEFuZ2xlIiwid2luZG93IiwiY3AiLCJ0dXJuVGFibGVOdW0iLCJnZXRJdGVtQnlMb2NhbFN0b3JhZ2UiLCJ0dXJuQ291bnQiLCJ2ZWRpb0NKIiwicGxheVNpbXBsZUF1ZGlvRW5naW5lIiwic3lzIiwicGxhdGZvcm0iLCJXRUNIQVRfR0FNRSIsIl9jcmVhdGVWZWRpb0FkIiwicmVzIiwiaXNFbmRlZCIsInJhdyIsImNqQWN0aW9uIiwiY2FsbGJhY2siLCJ0aGFua3MiLCJjb2lucyIsImNhcmRzIiwibnVtIiwiYW5nbGUiLCJyYW5kb20iLCJNYXRoIiwiYnV5Q29pblVwZ3JhZGUiLCJHYW1lUGVyc29uTWF4TGV2ZWwiLCJidXlHb2xkVXBncmFkZSIsIl90aGlzIiwiY2xpY2tUaW1lcyIsInJvdW5kcyIsInJvdGF0ZUJ5IiwiYWN0aW9uU3RlcCIsInJ1bkFjdGlvbiIsImVhc2luZyIsImVhc2VDdWJpY0FjdGlvbk91dCIsInNjaGVkdWxlT25jZSIsImNvbnNvbGUiLCJsb2ciLCJ1bmRlZmluZWQiLCJzaG93VG9hc3QiLCJwZXJOYW1lIiwibWFpbiIsImFkZERlc2tTcHJpdGVCeUxldmVsIiwiR2FtZUNvaW4iLCJzZXRJdGVtQnlMb2NhbFN0b3JhZ2UiLCJzZXRHYW1lQ29pbiIsIkdhbWVNb25leSIsInNldEdhbWVNb25leSIsImZyZWVDSiIsInN0cmluZyIsImNsb3NlIiwibm9kZSIsImRlc3Ryb3kiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7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QUM7RUFFREMsTUFBTSxFQUFHLFNBQUFBLE9BQUEsRUFBVTtJQUNmaEUsU0FBUyxDQUFDdUIscUJBQXFCLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLElBQUcsSUFBSSxDQUFDUixTQUFTLEVBQUM7TUFDZDtJQUNKO0lBQ0EsSUFBR2QsRUFBRSxDQUFDdUIsR0FBRyxDQUFDQyxRQUFRLEtBQUt4QixFQUFFLENBQUN1QixHQUFHLENBQUNFLFdBQVcsRUFBQztNQUN0QztJQUFBO0lBRUosSUFBRzVCLFVBQVUsQ0FBQ3FCLFlBQVksR0FBQyxDQUFDLEVBQUM7TUFDekJuQixTQUFTLENBQUN1RCxTQUFTLENBQUMsU0FBUyxDQUFDO01BQzlCO0lBQ0o7SUFDQSxJQUFJLENBQUN4QixRQUFRLENBQUMsWUFBVTtNQUNwQmpDLFVBQVUsQ0FBQ3FCLFlBQVksRUFBRTtNQUN6QkYsTUFBTSxDQUFDQyxFQUFFLENBQUNHLFNBQVMsRUFBRTtJQUN6QixDQUFDLENBQUM7RUFDTixDQUFDO0VBRUQ7RUFDQUEsU0FBUyxXQUFBQSxVQUFBLEVBQUU7SUFDUEosTUFBTSxDQUFDQyxFQUFFLENBQUNSLE9BQU8sQ0FBQ3VELE1BQU0sR0FBR25FLFVBQVUsQ0FBQ3FCLFlBQVk7SUFDbERuQixTQUFTLENBQUM0RCxxQkFBcUIsQ0FBQyxTQUFTLEVBQUM5RCxVQUFVLENBQUNxQixZQUFZLENBQUM7RUFDdEUsQ0FBQztFQUNEK0MsS0FBSyxFQUFHLFNBQUFBLE1BQUEsRUFBVTtJQUNkbEUsU0FBUyxDQUFDdUIscUJBQXFCLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLElBQUksQ0FBQzRDLElBQUksQ0FBQ0MsT0FBTyxFQUFFO0VBQ3ZCO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgR2FtZUNvbmZpZyA9IHJlcXVpcmUoXCJHYW1lQ29uZmlnXCIpO1xudmFyIEdhbWVUb29scyA9IHJlcXVpcmUoXCJHYW1lVG9vbHNcIik7XG5cbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGZyZWVDSkJ0biA6IGNjLk5vZGUsXG4gICAgICAgIHR1cm5UYWJsZSA6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOlwi6L2s55uYXCJcbiAgICAgICAgfSxcbiAgICAgICAgdHVybk51bSA6IGNjLkxhYmVsLFxuICAgIH0sXG4gICAgc3RhcnQoKXtcblxuICAgIH0sXG4gICAgb25Mb2FkKCl7XG4gICAgICAgIHRoaXMuaXNDbGljayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzVHVybmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxhc3RBbmdsZSA9IDA7XG4gICAgICAgIHdpbmRvdy5jcCA9IHRoaXM7XG5cbiAgICAgICAgR2FtZUNvbmZpZy50dXJuVGFibGVOdW0gPSBHYW1lVG9vbHMuZ2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwidHVybk51bVwiLDMpO1xuICAgICAgICB0aGlzLnR1cm5Db3VudCgpO1xuICAgICAgICBcbiAgICB9LFxuICAgIHZlZGlvQ0ogOiBmdW5jdGlvbigpe1xuICAgICAgICBHYW1lVG9vbHMucGxheVNpbXBsZUF1ZGlvRW5naW5lKDMpO1xuICAgICAgICBpZih0aGlzLmlzVHVybmluZyl7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG4gICAgICAgIGlmKGNjLnN5cy5wbGF0Zm9ybSA9PT0gY2Muc3lzLldFQ0hBVF9HQU1FKXtcbiAgICAgICAgICAgIC8vIHd4LmFsZFNlbmRFdmVudCgn6KeG6aKR5oq95aWWJyx7J2tleScgOiAndmFsdWUnfSk7XG4gICAgICAgIH1cbiAgICAgICAgR2FtZVRvb2xzLl9jcmVhdGVWZWRpb0FkKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIGlmIChyZXMuaXNFbmRlZCB8fCByZXMucmF3KSB7XG4gICAgICAgICAgICAgICAgR2FtZUNvbmZpZy50dXJuVGFibGVOdW0gKz0yO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5jcC50dXJuQ291bnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNqQWN0aW9uIDogZnVuY3Rpb24oY2FsbGJhY2spe1xuICAgICAgICAvLyBpZihjYy5zeXMucGxhdGZvcm0gPT09IGNjLnN5cy5XRUNIQVRfR0FNRSl7XG4gICAgICAgIC8vICAgICB3eC5hbGRTZW5kRXZlbnQoJ+WQr+WKqOi9rOebmCcseydrZXknIDogJ3ZhbHVlJ30pXG4gICAgICAgIC8vIH1cbiAgICAgICAgdGhpcy5pc0NsaWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc1R1cm5pbmcgPSB0cnVlO1xuICAgICAgICAvL+amgueOh+WHuue7k+aenFxuICAgICAgICBsZXQgdGhhbmtzID0gWzAsMTIwLDI0MF07Ly/ph5HpkrFcbiAgICAgICAgbGV0IGNvaW5zID0gWzYwLDMwMF07Ly/lhYPlrp1cbiAgICAgICAgbGV0IGNhcmRzID0gWzE4MF07Ly/kurpcbiAgICAgICAgbGV0IHR5cGU7XG4gICAgICAgIGxldCBudW07XG4gICAgICAgIGxldCBhbmdsZTtcbiAgICAgICAgbGV0IHJhbmRvbSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIGlmKHJhbmRvbSA8IDAuMDgpe1xuICAgICAgICAgICAgYW5nbGUgPSBjYXJkc1swXTtcbiAgICAgICAgfWVsc2UgaWYocmFuZG9tIDwgMC4yMCl7XG4gICAgICAgICAgICB0eXBlID0gJ2NvaW4nO1xuICAgICAgICAgICAgbnVtID0gR2FtZUNvbmZpZy5idXlDb2luVXBncmFkZVtHYW1lQ29uZmlnLkdhbWVQZXJzb25NYXhMZXZlbCsxXSoyO1xuICAgICAgICAgICAgYW5nbGUgPSBjb2luc1sxXTtcbiAgICAgICAgfWVsc2UgaWYocmFuZG9tIDwgMC4zNSl7XG4gICAgICAgICAgICB0eXBlID0gJ2NvaW4nO1xuICAgICAgICAgICAgbnVtID0gR2FtZUNvbmZpZy5idXlDb2luVXBncmFkZVtHYW1lQ29uZmlnLkdhbWVQZXJzb25NYXhMZXZlbCsxXSo0O1xuICAgICAgICAgICAgYW5nbGUgPSBjb2luc1swXTtcbiAgICAgICAgfWVsc2UgaWYoMC43KXtcbiAgICAgICAgICAgIHR5cGUgPSAnbW9uZXknO1xuICAgICAgICAgICAgbnVtID0gR2FtZUNvbmZpZy5idXlHb2xkVXBncmFkZVtHYW1lQ29uZmlnLkdhbWVQZXJzb25NYXhMZXZlbF0qNDtcbiAgICAgICAgICAgIGFuZ2xlID0gdGhhbmtzWzFdO1xuICAgICAgICB9ZWxzZSBpZigwLjgpe1xuICAgICAgICAgICAgdHlwZSA9ICdtb25leSc7XG4gICAgICAgICAgICBudW0gPSBHYW1lQ29uZmlnLmJ1eUdvbGRVcGdyYWRlW0dhbWVDb25maWcuR2FtZVBlcnNvbk1heExldmVsXSoyO1xuICAgICAgICAgICAgYW5nbGUgPSB0aGFua3NbMF07XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdHlwZSA9ICdtb25leSc7XG4gICAgICAgICAgICBudW0gPSBHYW1lQ29uZmlnLmJ1eUdvbGRVcGdyYWRlW0dhbWVDb25maWcuR2FtZVBlcnNvbk1heExldmVsXSo2O1xuICAgICAgICAgICAgYW5nbGUgPSB0aGFua3NbMl07XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgY2xpY2tUaW1lcyA9IDY7XG4gICAgICAgIHZhciByb3VuZHMgPSAxMDtcbiAgICAgICAgdmFyIHJvdGF0ZUJ5ID0gY2Mucm90YXRlQnkoY2xpY2tUaW1lcyx0aGlzLmxhc3RBbmdsZS0oYW5nbGUgKyAzNjAqcm91bmRzKSk7XG5cbiAgICAgICAgdmFyIGFjdGlvblN0ZXAgPSBfdGhpcy50dXJuVGFibGUucnVuQWN0aW9uKHJvdGF0ZUJ5KS5lYXNpbmcoY2MuZWFzZUN1YmljQWN0aW9uT3V0KGNsaWNrVGltZXMpKTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMubGFzdEFuZ2xlID0gYW5nbGU7XG4gICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codHlwZStcIiA6IFwiK251bSk7XG4gICAgICAgICAgICB0aGlzLmlzVHVybmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgaWYodHlwZSA9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIEdhbWVUb29scy5zaG93VG9hc3QoJ+iOt+W+lycrR2FtZUNvbmZpZy5wZXJOYW1lW0dhbWVDb25maWcuR2FtZVBlcnNvbk1heExldmVsLTFdKTtcbiAgICAgICAgICAgICAgICBHYW1lQ29uZmlnLm1haW4uYWRkRGVza1Nwcml0ZUJ5TGV2ZWwoR2FtZUNvbmZpZy5HYW1lUGVyc29uTWF4TGV2ZWwpO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgaWYodHlwZSA9PSAnY29pbicpe1xuICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2hvd1RvYXN0KFwi6I635b6XXCIrbnVtK1wi5YWD5a6dXCIpO1xuICAgICAgICAgICAgICAgICAgICBHYW1lQ29uZmlnLkdhbWVDb2luICs9IG51bTtcbiAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcIkdhbWVDb2luXCIsR2FtZUNvbmZpZy5HYW1lQ29pbik7XG4gICAgICAgICAgICAgICAgICAgIEdhbWVDb25maWcubWFpbi5zZXRHYW1lQ29pbigpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2hvd1RvYXN0KFwi6I635b6XXCIrbnVtK1wi6ZOc6ZKxXCIpO1xuICAgICAgICAgICAgICAgICAgICBHYW1lQ29uZmlnLkdhbWVNb25leSArPSBudW07XG4gICAgICAgICAgICAgICAgICAgIEdhbWVUb29scy5zZXRJdGVtQnlMb2NhbFN0b3JhZ2UoXCJHYW1lTW9uZXlcIixHYW1lQ29uZmlnLkdhbWVNb25leSk7XG4gICAgICAgICAgICAgICAgICAgIEdhbWVDb25maWcubWFpbi5zZXRHYW1lTW9uZXkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sNik7XG4gICAgfSxcblxuICAgIGZyZWVDSiA6IGZ1bmN0aW9uKCl7XG4gICAgICAgIEdhbWVUb29scy5wbGF5U2ltcGxlQXVkaW9FbmdpbmUoMyk7XG4gICAgICAgIGlmKHRoaXMuaXNUdXJuaW5nKXtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY2Muc3lzLnBsYXRmb3JtID09PSBjYy5zeXMuV0VDSEFUX0dBTUUpe1xuICAgICAgICAgICAgLy8gd3guYWxkU2VuZEV2ZW50KCfmir3lpZYnLHsna2V5JyA6ICd2YWx1ZSd9KTtcbiAgICAgICAgfVxuICAgICAgICBpZihHYW1lQ29uZmlnLnR1cm5UYWJsZU51bTwxKXtcbiAgICAgICAgICAgIEdhbWVUb29scy5zaG93VG9hc3QoXCLmmoLml6Dmir3lpZbmnLrkvJrlk6ZcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jakFjdGlvbihmdW5jdGlvbigpe1xuICAgICAgICAgICAgR2FtZUNvbmZpZy50dXJuVGFibGVOdW0tLTtcbiAgICAgICAgICAgIHdpbmRvdy5jcC50dXJuQ291bnQoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5oq95aWW5qyh5pWw55qE5Y+Y5YqoXG4gICAgdHVybkNvdW50KCl7XG4gICAgICAgIHdpbmRvdy5jcC50dXJuTnVtLnN0cmluZyA9IEdhbWVDb25maWcudHVyblRhYmxlTnVtO1xuICAgICAgICBHYW1lVG9vbHMuc2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwidHVybk51bVwiLEdhbWVDb25maWcudHVyblRhYmxlTnVtKTtcbiAgICB9LFxuICAgIGNsb3NlIDogZnVuY3Rpb24oKXtcbiAgICAgICAgR2FtZVRvb2xzLnBsYXlTaW1wbGVBdWRpb0VuZ2luZSgzKTtcbiAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKTtcbiAgICB9LFxufSk7XG5cbiJdfQ==