
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/eq4096.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5b4d8xPgKNFmqt5jom0Qwwj', 'eq4096');
// Script/eq4096.js

"use strict";

var eqconf = require('./eqconf.js');
var EQ = {
  peq: null,
  Enable: function Enable() {
    if (this.peq) this.peq.config.enable = true;
  },
  Disable: function Disable() {
    if (this.peq) this.peq.config.enable = false;
  },
  init: function init(config) {
    var _this = this;
    this.config = config;
    this.config.cid = eqconf.EQCID;
    this.config.appid = eqconf.WXAPPID;
    this.config.wxauth = eqconf.EQWXAUTH;
    this.config.version = eqconf.EQVERSION;
    this.config.enable = false;
    this.config.data = {};
    wx.onShow(function (res) {
      _this.onShow(res);
    });
    wx.onHide(function (res) {
      _this.onHide(res);
    });
    wx.onError(function (msg, stack) {
      _this.onError(msg, stack);
    });
    this.config.launcheroption = wx.getLaunchOptionsSync();
    wx.getSystemInfo(function (res) {
      _this.config.sysinfo = res;
    }, function (e) {}, function (f) {});
    wx.onTouchEnd(function (res) {
      _this.touchend(res);
    });
    this.peq = this;
    this.peq.syncdata();
  },
  event: function event(e) {
    this.peq.config.event = e;
    this.peq.syncdata();
    this.peq.config.event = undefined;
  },
  codelogin: function codelogin(res) {
    var _this2 = this;
    console.log("codelogin===》", res);
    this.d(res);
    this.config.code = res.code;
    this.d(this.config);
    wx.request({
      url: this.config.wxlogin,
      method: "POST",
      dataType: "json",
      data: this.config,
      success: function success(d) {
        _this2.d(d);
        console.log("微信登录===》", d.data.data);
        if (d.data.ret == 0) {
          var openid = d.data.data.openid;
          res.openid = openid;
          _this2.showuserinfobutton(res);
        } else {
          res.fail(d.data);
        }
      },
      fail: function fail(data) {
        _this2.d(data);
        res.fail(data);
      }
    });
  },
  wxlogin: function wxlogin(config) {
    var _this3 = this;
    console.log("wxlogin===》", config);
    wx.login({
      success: function success(res) {
        _this3.d(res);
        console.log("微信登录code===》", res);
        if (res.code) {
          config.code = res.code;
          _this3.peq.codelogin(config);
        } else {
          config.fail(res);
        }
      }
    });
  },
  login: function login(config) {
    var _this4 = this;
    console.log("login===》", config);
    wx.checkSession({
      success: function success(res) {
        // 未过期
        config.success(res);
        wx.getStorage({
          key: 'eq4096user.json',
          success: function success(res) {
            if (res.data) {
              _this4.peq.d("read userinfo");
              config.success(res.data);
            } else {
              _this4.peq.wxlogin(config);
            }
          },
          fail: function fail(res) {
            _this4.peq.wxlogin(config);
          }
        });
      },
      fail: function fail() {
        // 过期
        _this4.peq.wxlogin(config);
      }
    });
  },
  showuserinfobutton: function showuserinfobutton(res) {
    var _this5 = this;
    var button = wx.createUserInfoButton(res);
    button.onTap(function (p) {
      _this5.d(p);
      p.openId = res.openid;
      p.userInfo.openId = res.openid;
      _this5.config.userinfo = p;
      wx.setStorage({
        key: 'eq4096user.json',
        data: p,
        success: function success(p2) {
          res.success(p);
          button.destroy();
        },
        fail: function fail(p3) {
          res.fail(p3);
        }
      });
      _this5.syncdata();
    });
  },
  getconfig: function getconfig() {
    return this.peq.config;
  },
  setuserinfo: function setuserinfo(userinfo) {
    if (!this.peq.config.userinfo) {
      this.peq.config.userinfo = userinfo;
      this.peq.syncdata();
    }
  },
  d: function d(s) {
    if (this.config.debug) console.log(s);
  },
  onError: function onError(msg, stack) {
    this.config.error = {
      msg: msg,
      stack: stack
    };
    this.syncdata();
    this.config.error = undefined;
    if (this.config.onError) {
      this.config.onError(msg, stack);
    }
  },
  touchend: function touchend(res) {
    this.touchflag = true;
  },
  syncdata: function syncdata() {
    var _this6 = this;
    this.d(JSON.stringify(this.config));
    wx.request({
      url: this.config.api_url,
      method: "POST",
      dataType: "json",
      data: this.config,
      success: function success(d) {
        _this6.d(d);
        if (d.data.ret == 0) {
          _this6.parseconfig(d.data.data);
        }
      },
      fail: function fail(data) {
        console.log(data);
      }
    });
  },
  touch: function touch(d) {
    var _this7 = this;
    switch (d.type) {
      case "img":
        wx.previewImage({
          urls: [d["shareimage"]]
        });
        break;
      case "wxapp":
        {
          d.success = function () {
            _this7.peq.config.opdata = d;
            _this7.peq.syncdata();
            _this7.peq.config.opdata = undefined;
          };
          wx[d["op"]](d);
        }
        break;
    }
  },
  SyncData: function SyncData() {
    if (this.peq) this.peq.syncdata();
  },
  onShow: function onShow(res) {
    this.config.start_res = res;
    if (this.config.onShow) {
      this.config.onShow(res);
    }
  },
  onHide: function onHide(res) {
    if (this.config.onHide) this.config.onHide(res);
  },
  parseconfig: function parseconfig(data) {
    this.config.data = data;
    if (this.config.parse) {
      this.config.parse(data);
    }
  }
};
module.exports = EQ;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxlcTQwOTYuanMiXSwibmFtZXMiOlsiZXFjb25mIiwicmVxdWlyZSIsIkVRIiwicGVxIiwiRW5hYmxlIiwiY29uZmlnIiwiZW5hYmxlIiwiRGlzYWJsZSIsImluaXQiLCJfdGhpcyIsImNpZCIsIkVRQ0lEIiwiYXBwaWQiLCJXWEFQUElEIiwid3hhdXRoIiwiRVFXWEFVVEgiLCJ2ZXJzaW9uIiwiRVFWRVJTSU9OIiwiZGF0YSIsInd4Iiwib25TaG93IiwicmVzIiwib25IaWRlIiwib25FcnJvciIsIm1zZyIsInN0YWNrIiwibGF1bmNoZXJvcHRpb24iLCJnZXRMYXVuY2hPcHRpb25zU3luYyIsImdldFN5c3RlbUluZm8iLCJzeXNpbmZvIiwiZSIsImYiLCJvblRvdWNoRW5kIiwidG91Y2hlbmQiLCJzeW5jZGF0YSIsImV2ZW50IiwidW5kZWZpbmVkIiwiY29kZWxvZ2luIiwiX3RoaXMyIiwiY29uc29sZSIsImxvZyIsImQiLCJjb2RlIiwicmVxdWVzdCIsInVybCIsInd4bG9naW4iLCJtZXRob2QiLCJkYXRhVHlwZSIsInN1Y2Nlc3MiLCJyZXQiLCJvcGVuaWQiLCJzaG93dXNlcmluZm9idXR0b24iLCJmYWlsIiwiX3RoaXMzIiwibG9naW4iLCJfdGhpczQiLCJjaGVja1Nlc3Npb24iLCJnZXRTdG9yYWdlIiwia2V5IiwiX3RoaXM1IiwiYnV0dG9uIiwiY3JlYXRlVXNlckluZm9CdXR0b24iLCJvblRhcCIsInAiLCJvcGVuSWQiLCJ1c2VySW5mbyIsInVzZXJpbmZvIiwic2V0U3RvcmFnZSIsInAyIiwiZGVzdHJveSIsInAzIiwiZ2V0Y29uZmlnIiwic2V0dXNlcmluZm8iLCJzIiwiZGVidWciLCJlcnJvciIsInRvdWNoZmxhZyIsIl90aGlzNiIsIkpTT04iLCJzdHJpbmdpZnkiLCJhcGlfdXJsIiwicGFyc2Vjb25maWciLCJ0b3VjaCIsIl90aGlzNyIsInR5cGUiLCJwcmV2aWV3SW1hZ2UiLCJ1cmxzIiwib3BkYXRhIiwiU3lu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QUFNLENBQUNDLE9BQU8sR0FBRzFGLEVBQUUiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIlxudmFyIGVxY29uZiA9IHJlcXVpcmUoJy4vZXFjb25mLmpzJyk7XG5cbnZhciBFUSA9IHtcbiAgICBwZXEgOiBudWxsLFxuICAgIEVuYWJsZSgpIHtcbiAgICBpZiAodGhpcy5wZXEpIHRoaXMucGVxLmNvbmZpZy5lbmFibGUgPSB0cnVlO1xuICB9LFxuICAgRGlzYWJsZSgpIHtcbiAgICBpZiAodGhpcy5wZXEpdGhpcy5wZXEuY29uZmlnLmVuYWJsZSA9IGZhbHNlO1xuICB9LFxuICBpbml0KGNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuY29uZmlnLmNpZCA9IGVxY29uZi5FUUNJRDtcbiAgICB0aGlzLmNvbmZpZy5hcHBpZCA9IGVxY29uZi5XWEFQUElEO1xuICAgIHRoaXMuY29uZmlnLnd4YXV0aCA9IGVxY29uZi5FUVdYQVVUSDtcbiAgICB0aGlzLmNvbmZpZy52ZXJzaW9uID0gZXFjb25mLkVRVkVSU0lPTjtcbiAgICB0aGlzLmNvbmZpZy5lbmFibGUgPSBmYWxzZTtcbiAgICB0aGlzLmNvbmZpZy5kYXRhID0ge307XG4gICAgd3gub25TaG93KChyZXMpID0+IHsgdGhpcy5vblNob3cocmVzKTsgfSk7XG4gICAgd3gub25IaWRlKChyZXMpID0+IHsgdGhpcy5vbkhpZGUocmVzKTsgfSk7XG4gICAgd3gub25FcnJvcigobXNnLCBzdGFjaykgPT4geyB0aGlzLm9uRXJyb3IobXNnLCBzdGFjayk7IH0pO1xuICAgIHRoaXMuY29uZmlnLmxhdW5jaGVyb3B0aW9uID0gd3guZ2V0TGF1bmNoT3B0aW9uc1N5bmMoKTtcbiAgICB3eC5nZXRTeXN0ZW1JbmZvKChyZXMpID0+IHtcbiAgICAgIHRoaXMuY29uZmlnLnN5c2luZm8gPSByZXM7XG4gICAgfSwgKGUpID0+IHsgfSwgKGYpID0+IHsgfSk7XG4gICAgd3gub25Ub3VjaEVuZCgocmVzKSA9PiB7XG4gICAgICB0aGlzLnRvdWNoZW5kKHJlcyk7XG4gICAgfSk7XG4gICAgdGhpcy5wZXEgPSB0aGlzO1xuICAgIHRoaXMucGVxLnN5bmNkYXRhKCk7XG5cbiAgfSxcbiAgZXZlbnQoZSkge1xuICAgIHRoaXMucGVxLmNvbmZpZy5ldmVudCA9IGU7XG4gICAgdGhpcy5wZXEuc3luY2RhdGEoKTtcbiAgICB0aGlzLnBlcS5jb25maWcuZXZlbnQgPSB1bmRlZmluZWQ7XG4gIH0sXG4gIGNvZGVsb2dpbihyZXMpIHtcbiAgICBjb25zb2xlLmxvZyhcImNvZGVsb2dpbj09PeOAi1wiLCByZXMpXG4gICAgdGhpcy5kKHJlcyk7XG4gICAgdGhpcy5jb25maWcuY29kZSA9IHJlcy5jb2RlO1xuICAgIHRoaXMuZCh0aGlzLmNvbmZpZyk7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICB1cmw6IHRoaXMuY29uZmlnLnd4bG9naW4sXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgZGF0YTogdGhpcy5jb25maWcsXG4gICAgICBzdWNjZXNzOiAoZCkgPT4ge1xuICAgICAgICB0aGlzLmQoZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi5b6u5L+h55m75b2VPT0944CLXCIsIGQuZGF0YS5kYXRhKVxuICAgICAgICBpZiAoZC5kYXRhLnJldCA9PSAwKSB7XG4gICAgICAgICAgdmFyIG9wZW5pZCA9IGQuZGF0YS5kYXRhLm9wZW5pZDtcbiAgICAgICAgICByZXMub3BlbmlkID0gb3BlbmlkO1xuICAgICAgICAgIHRoaXMuc2hvd3VzZXJpbmZvYnV0dG9uKHJlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLmZhaWwoZC5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGZhaWw6IChkYXRhKSA9PiB7XG4gICAgICAgIHRoaXMuZChkYXRhKTtcbiAgICAgICAgcmVzLmZhaWwoZGF0YSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cblxuXG4gIHd4bG9naW4oY29uZmlnKSB7XG4gICAgY29uc29sZS5sb2coXCJ3eGxvZ2luPT0944CLXCIsIGNvbmZpZylcbiAgICB3eC5sb2dpbih7XG4gICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgIHRoaXMuZChyZXMpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIuW+ruS/oeeZu+W9lWNvZGU9PT3jgItcIiwgcmVzKVxuICAgICAgICBpZiAocmVzLmNvZGUpIHtcbiAgICAgICAgICBjb25maWcuY29kZSA9IHJlcy5jb2RlO1xuICAgICAgICAgIHRoaXMucGVxLmNvZGVsb2dpbihjb25maWcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbmZpZy5mYWlsKHJlcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBsb2dpbihjb25maWcpIHtcbiAgICBjb25zb2xlLmxvZyhcImxvZ2luPT0944CLXCIsIGNvbmZpZylcbiAgICB3eC5jaGVja1Nlc3Npb24oe1xuICAgICAgc3VjY2VzczoocmVzKT0+e1xuICAgICAgICAvLyDmnKrov4fmnJ9cbiAgICAgICAgY29uZmlnLnN1Y2Nlc3MocmVzKTtcbiAgICAgICAgd3guZ2V0U3RvcmFnZSh7XG4gICAgICAgICAga2V5OidlcTQwOTZ1c2VyLmpzb24nLCBcbiAgICAgICAgICBzdWNjZXNzOiAocmVzKT0+IHtcbiAgICAgICAgICAgIGlmKHJlcy5kYXRhKSB7XG4gICAgICAgICAgICAgIHRoaXMucGVxLmQoXCJyZWFkIHVzZXJpbmZvXCIpO1xuICAgICAgICAgICAgICBjb25maWcuc3VjY2VzcyhyZXMuZGF0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnBlcS53eGxvZ2luKGNvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsOihyZXMpPT57XG4gICAgICAgICAgICB0aGlzLnBlcS53eGxvZ2luKGNvbmZpZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBmYWlsOigpPT57XG4gICAgICAgIC8vIOi/h+acn1xuICAgICAgICB0aGlzLnBlcS53eGxvZ2luKGNvbmZpZyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIHNob3d1c2VyaW5mb2J1dHRvbihyZXMpIHtcbiAgICBsZXQgYnV0dG9uID0gd3guY3JlYXRlVXNlckluZm9CdXR0b24ocmVzKTtcbiAgICBidXR0b24ub25UYXAoKHApID0+IHtcbiAgICAgIHRoaXMuZChwKTtcbiAgICAgIHAub3BlbklkID0gcmVzLm9wZW5pZDtcbiAgICAgIHAudXNlckluZm8ub3BlbklkID0gcmVzLm9wZW5pZDtcbiAgICAgIHRoaXMuY29uZmlnLnVzZXJpbmZvID0gcDtcbiAgICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAgICBrZXk6ICdlcTQwOTZ1c2VyLmpzb24nLFxuICAgICAgICBkYXRhOiBwLFxuICAgICAgICBzdWNjZXNzOiAocDIpPT4ge1xuICAgICAgICAgIHJlcy5zdWNjZXNzKHApO1xuICAgICAgICAgIGJ1dHRvbi5kZXN0cm95KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWw6IChwMyk9PiB7XG4gICAgICAgICAgcmVzLmZhaWwocDMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3luY2RhdGEoKTtcbiAgICB9KTtcbiAgfSxcblxuICBnZXRjb25maWcoKSB7XG4gICAgcmV0dXJuIHRoaXMucGVxLmNvbmZpZztcbiAgfSxcbiAgc2V0dXNlcmluZm8odXNlcmluZm8pIHtcbiAgICBpZiAoIXRoaXMucGVxLmNvbmZpZy51c2VyaW5mbykge1xuICAgICAgdGhpcy5wZXEuY29uZmlnLnVzZXJpbmZvID0gdXNlcmluZm87XG4gICAgICB0aGlzLnBlcS5zeW5jZGF0YSgpO1xuICAgIH1cbiAgfSxcbiAgZChzKSB7XG4gICAgaWYgKHRoaXMuY29uZmlnLmRlYnVnKSBjb25zb2xlLmxvZyhzKTtcbiAgfSxcblxuXG4gIG9uRXJyb3IobXNnLCBzdGFjaykge1xuICAgIHRoaXMuY29uZmlnLmVycm9yID0geyBtc2csIHN0YWNrIH07XG4gICAgdGhpcy5zeW5jZGF0YSgpO1xuICAgIHRoaXMuY29uZmlnLmVycm9yID0gdW5kZWZpbmVkO1xuICAgIGlmICh0aGlzLmNvbmZpZy5vbkVycm9yKSB7XG4gICAgICB0aGlzLmNvbmZpZy5vbkVycm9yKG1zZywgc3RhY2spO1xuICAgIH1cbiAgfSxcbiAgdG91Y2hlbmQocmVzKSB7XG4gICAgdGhpcy50b3VjaGZsYWcgPSB0cnVlO1xuICB9LFxuICBzeW5jZGF0YSgpIHtcbiAgICB0aGlzLmQoSlNPTi5zdHJpbmdpZnkodGhpcy5jb25maWcpKTtcbiAgICB3eC5yZXF1ZXN0KHtcbiAgICAgIHVybDogdGhpcy5jb25maWcuYXBpX3VybCxcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICBkYXRhOiB0aGlzLmNvbmZpZyxcbiAgICAgIHN1Y2Nlc3M6IChkKSA9PiB7XG4gICAgICAgIHRoaXMuZChkKTtcbiAgICAgICAgaWYgKGQuZGF0YS5yZXQgPT0gMCkge1xuICAgICAgICAgIHRoaXMucGFyc2Vjb25maWcoZC5kYXRhLmRhdGEpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZmFpbDogKGRhdGEpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgdG91Y2goZCkge1xuICAgIHN3aXRjaCAoZC50eXBlKSB7XG4gICAgICBjYXNlIFwiaW1nXCI6XG4gICAgICAgIHd4LnByZXZpZXdJbWFnZSh7IHVybHM6IFtkW1wic2hhcmVpbWFnZVwiXV0gfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInd4YXBwXCI6IHtcbiAgICAgICAgZC5zdWNjZXNzID0gKCkgPT4ge1xuICAgICAgICAgIHRoaXMucGVxLmNvbmZpZy5vcGRhdGEgPSBkO1xuICAgICAgICAgIHRoaXMucGVxLnN5bmNkYXRhKCk7XG4gICAgICAgICAgdGhpcy5wZXEuY29uZmlnLm9wZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcbiAgICAgICAgd3hbZFtcIm9wXCJdXShkKTtcbiAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuICBTeW5jRGF0YSgpXG4gIHtcbiAgICBpZih0aGlzLnBlcSkgdGhpcy5wZXEuc3luY2RhdGEoKTtcbiAgfSxcbiAgb25TaG93KHJlcykge1xuICAgIHRoaXMuY29uZmlnLnN0YXJ0X3JlcyA9IHJlcztcbiAgICBpZiAodGhpcy5jb25maWcub25TaG93KSB7XG4gICAgICB0aGlzLmNvbmZpZy5vblNob3cocmVzKTtcbiAgICB9XG4gIH0sXG5cbiAgb25IaWRlKHJlcykge1xuICAgIGlmICh0aGlzLmNvbmZpZy5vbkhpZGUpXG4gICAgICB0aGlzLmNvbmZpZy5vbkhpZGUocmVzKTtcbiAgfSxcblxuICBwYXJzZWNvbmZpZyhkYXRhKSB7XG4gICAgICB0aGlzLmNvbmZpZy5kYXRhID0gZGF0YTtcbiAgICAgIGlmKHRoaXMuY29uZmlnLnBhcnNlKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLnBhcnNlKGRhdGEpO1xuICAgICAgfVxuXG4gIH1cbn07XG5tb2R1bGUuZXhwb3J0cyA9IEVRO1xuIl19