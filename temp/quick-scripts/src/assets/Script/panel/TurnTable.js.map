{"version":3,"sources":["assets\\Script\\panel\\TurnTable.js"],"names":["GameConfig","require","GameTools","cc","Class","Component","properties","freeCJBtn","Node","turnTable","type","displayName","turnNum","Label","start","onLoad","isClick","isTurning","lastAngle","window","cp","turnTableNum","getItemByLocalStorage","turnCount","vedioCJ","playSimpleAudioEngine","sys","platform","WECHAT_GAME","_createVedioAd","res","isEnded","raw","cjAction","callback","thanks","coins","cards","num","angle","random","Math","buyCoinUpgrade","GamePersonMaxLevel","buyGoldUpgrade","_this","clickTimes","rounds","rotateBy","actionStep","runAction","easing","easeCubicActionOut","scheduleOnce","console","log","undefined","showToast","perName","main","addDeskSpriteByLevel","GameCoin","setItemByLocalStorage","setGameCoin","GameMoney","setGameMoney","freeCJ","string","close","node","destroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["var GameConfig = require(\"GameConfig\");\nvar GameTools = require(\"GameTools\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        freeCJBtn : cc.Node,\n        turnTable : {\n            default:null,\n            type:cc.Node,\n            displayName:\"转盘\"\n        },\n        turnNum : cc.Label,\n    },\n    start(){\n\n    },\n    onLoad(){\n        this.isClick = false;\n        this.isTurning = false;\n        this.lastAngle = 0;\n        window.cp = this;\n\n        GameConfig.turnTableNum = GameTools.getItemByLocalStorage(\"turnNum\",3);\n        this.turnCount();\n        \n    },\n    vedioCJ : function(){\n        GameTools.playSimpleAudioEngine(3);\n        if(this.isTurning){\n            return ;\n        }\n        if(cc.sys.platform === cc.sys.WECHAT_GAME){\n            // wx.aldSendEvent('视频抽奖',{'key' : 'value'});\n        }\n        GameTools._createVedioAd(function (res) {\n            if (res.isEnded || res.raw) {\n                GameConfig.turnTableNum +=2;\n                window.cp.turnCount();\n            }\n        });\n    },\n\n    cjAction : function(callback){\n        // if(cc.sys.platform === cc.sys.WECHAT_GAME){\n        //     wx.aldSendEvent('启动转盘',{'key' : 'value'})\n        // }\n        this.isClick = true;\n        this.isTurning = true;\n        //概率出结果\n        let thanks = [0,120,240];//金钱\n        let coins = [60,300];//元宝\n        let cards = [180];//人\n        let type;\n        let num;\n        let angle;\n        let random = Math.random();\n        if(random < 0.08){\n            angle = cards[0];\n        }else if(random < 0.20){\n            type = 'coin';\n            num = GameConfig.buyCoinUpgrade[GameConfig.GamePersonMaxLevel+1]*2;\n            angle = coins[1];\n        }else if(random < 0.35){\n            type = 'coin';\n            num = GameConfig.buyCoinUpgrade[GameConfig.GamePersonMaxLevel+1]*4;\n            angle = coins[0];\n        }else if(0.7){\n            type = 'money';\n            num = GameConfig.buyGoldUpgrade[GameConfig.GamePersonMaxLevel]*4;\n            angle = thanks[1];\n        }else if(0.8){\n            type = 'money';\n            num = GameConfig.buyGoldUpgrade[GameConfig.GamePersonMaxLevel]*2;\n            angle = thanks[0];\n        }else{\n            type = 'money';\n            num = GameConfig.buyGoldUpgrade[GameConfig.GamePersonMaxLevel]*6;\n            angle = thanks[2];\n        }\n\n        var _this = this;\n        var clickTimes = 6;\n        var rounds = 10;\n        var rotateBy = cc.rotateBy(clickTimes,this.lastAngle-(angle + 360*rounds));\n\n        var actionStep = _this.turnTable.runAction(rotateBy).easing(cc.easeCubicActionOut(clickTimes));\n        this.scheduleOnce(function(){\n            this.lastAngle = angle;\n            callback && callback();\n            console.log(type+\" : \"+num);\n            this.isTurning = false;\n            if(type == undefined){\n                GameTools.showToast('获得'+GameConfig.perName[GameConfig.GamePersonMaxLevel-1]);\n                GameConfig.main.addDeskSpriteByLevel(GameConfig.GamePersonMaxLevel);\n            }else{\n                if(type == 'coin'){\n                    GameTools.showToast(\"获得\"+num+\"元宝\");\n                    GameConfig.GameCoin += num;\n                    GameTools.setItemByLocalStorage(\"GameCoin\",GameConfig.GameCoin);\n                    GameConfig.main.setGameCoin();\n                }else{\n                    GameTools.showToast(\"获得\"+num+\"铜钱\");\n                    GameConfig.GameMoney += num;\n                    GameTools.setItemByLocalStorage(\"GameMoney\",GameConfig.GameMoney);\n                    GameConfig.main.setGameMoney();\n                }\n            }\n        },6);\n    },\n\n    freeCJ : function(){\n        GameTools.playSimpleAudioEngine(3);\n        if(this.isTurning){\n            return ;\n        }\n        if(cc.sys.platform === cc.sys.WECHAT_GAME){\n            // wx.aldSendEvent('抽奖',{'key' : 'value'});\n        }\n        if(GameConfig.turnTableNum<1){\n            GameTools.showToast(\"暂无抽奖机会哦\");\n            return;\n        }\n        this.cjAction(function(){\n            GameConfig.turnTableNum--;\n            window.cp.turnCount();\n        });\n    },\n\n    //抽奖次数的变动\n    turnCount(){\n        window.cp.turnNum.string = GameConfig.turnTableNum;\n        GameTools.setItemByLocalStorage(\"turnNum\",GameConfig.turnTableNum);\n    },\n    close : function(){\n        GameTools.playSimpleAudioEngine(3);\n        this.node.destroy();\n    },\n});\n\n"]}